{% extends '_base.html' %}
{% load static %}

{% block title %}購入確認{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/app/purchase_confirm.css' %}">
{% endblock %}

{% block content %}
<div class="container py-5">
  <h2 class="mb-4 text-center">購入内容の確認</h2>

  <div class="card p-4 shadow-sm">
    <h4>{{ movie.title }}</h4>
    <p><strong>上映日時:</strong> {{ selected_datetime }}</p>
    <p><strong>シアター:</strong> {{ movie.theater }}</p>
    <p><strong>上映時間:</strong> {{ movie.duration }}分</p>

    <hr>

    <p><strong>選択された座席:</strong> {{ selected_seat_numbers|join:", " }}</p>
    <p><strong>座席数:</strong> {{ selected_seat_count }} 席</p>
    <p><strong>金額:</strong> ¥{{ movie.price|floatformat:"0" }}</p>
    <p class="fs-5 fw-bold text-success">合計金額: ¥{{ total_price|floatformat:"0" }}</p>

    <div class="mt-4">
      <a href="{% url 'seat_select' movie.id %}" class="btn btn-secondary me-3">座席を選び直す</a>

      <form method="post" action="{% url 'purchase_complete' %}" style="display: inline;">
        {% csrf_token %}
        <input type="hidden" name="movie_id" value="{{ movie.id }}">
        {% for seat_id in selected_seat_ids %}
          <input type="hidden" name="seats" value="{{ seat_id }}">
        {% endfor %}
        <button type="submit" class="btn btn-success">購入を確定する</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
